<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GREEN GOLDEN - Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/628/628283.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Ù…ÙƒØªØ¨Ø§Øª ÙÙŠØ±Ø¨Ø§Ø³ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* --- Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ --- */
        :root { --primary: #2e7d32; --secondary: #b7950b; --glass-bg: rgba(255, 255, 255, 0.75); --glass-border: 1px solid rgba(255, 255, 255, 0.6); --text-main: #1a1a1a; --danger: #c62828; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; margin: 0; padding: 0; }
        body { background-image: url("https://images.pexels.com/photos/5231086/pexels-photo-5231086.jpeg"); background-size: cover; background-position: center; background-attachment: fixed; color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(240, 240, 240, 0.2); backdrop-filter: blur(4px); z-index: -1; pointer-events: none; }
        
        header { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); padding: 10px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); position: sticky; top: 0; z-index: 1000; height: 85px; border-bottom: 1px solid rgba(255, 255, 255, 0.5); transition: all 0.3s ease; }
        .logo-container { display: flex; align-items: center; gap: 15px; text-decoration: none; }
        .logo-img { height: 60px; width: auto; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2)); }
        .logo-text-box { display: flex; flex-direction: column; }
        .logo-text { font-size: 1.6rem; font-weight: 800; color: var(--primary); margin: 0; }
        .logo-sub { font-size: 0.85rem; color: #555; font-weight: 600; }
        .nav-btn { background: white; border: 1px solid #ddd; width: 45px; height: 45px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; margin-right: 10px; color: var(--text-main); transition: 0.3s; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); position: relative; }
        .nav-btn:hover { background: var(--primary); color: white; transform: translateY(-3px); }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; padding: 4px 7px; font-size: 0.7rem; border: 2px solid white; font-weight: bold; }
        
        .hero-slider { height: 400px; position: relative; overflow: hidden; border-bottom: 5px solid var(--secondary); background: #000; }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity 1s ease-in-out; background-size: cover; background-position: center; }
        .slide.active { opacity: 1; }
        .slide::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); }
        .slide-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(5px); padding: 20px 40px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.3); width: 80%; max-width: 600px; }
        .slide-content h2 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 2px 5px black; }
        .slide-content p { font-size: 1.2rem; font-weight: bold; }
        
        .card { background: var(--glass-bg); backdrop-filter: blur(10px); border-radius: 20px; border: var(--glass-border); box-shadow: var(--shadow); overflow: hidden; transition: 0.3s; display: flex; flex-direction: column; position: relative; }
        .card:hover { transform: translateY(-8px); background: rgba(255, 255, 255, 0.95); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15); }
        .img-wrapper { height: 200px; overflow: hidden; position: relative; background: #fff; cursor: help; }
        .card-img { width: 100%; height: 100%; object-fit: contain; padding: 10px; transition: 0.5s; }
        .card:hover .card-img { transform: scale(1.08); }
        .desc-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.96); padding: 15px; opacity: 0; transition: 0.3s; overflow-y: auto; pointer-events: none; color: #333; font-size: 0.9rem; line-height: 1.6; display: flex; flex-direction: column; }
        .img-wrapper:hover .desc-overlay, .img-wrapper.active .desc-overlay { opacity: 1; pointer-events: auto; }
        .card-body { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-cat { font-size: 0.75rem; color: #777; font-weight: bold; letter-spacing: 0.5px; }
        .card-title { font-size: 1.2rem; font-weight: 800; margin: 5px 0; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-price { font-size: 1.3rem; color: var(--primary); font-weight: bold; margin-bottom: 10px; }
        .card-actions { display: flex; gap: 8px; margin-top: auto; }
        .qty-input { width: 50px; text-align: center; border: 1px solid #ccc; border-radius: 8px; font-weight: bold; font-size: 1rem; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); }
        .btn:hover { filter: brightness(1.1); transform: translateY(-2px); }
        .btn-danger { background: var(--danger); }
        .btn-warning { background: #f39c12; color: #fff; }
        
        .sticky-filter-container { position: sticky; top: 85px; z-index: 900; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.5); padding: 10px 0; margin-bottom: 20px; }
        .filters { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; }
        .filter-btn { background: white; border: 1px solid #ddd; padding: 6px 18px; border-radius: 20px; cursor: pointer; font-weight: bold; color: #555; transition: 0.3s; font-size: 0.95rem; }
        .filter-btn.active, .filter-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .sub-filters { display: none; justify-content: center; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
        .sub-filter-btn { font-size: 0.85rem; padding: 4px 12px; border-radius: 15px; border: 1px solid var(--secondary); background: rgba(255, 255, 255, 0.8); color: var(--secondary); cursor: pointer; }
        .sub-filter-btn.active { background: var(--secondary); color: white; }
        
        /* ===== ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø¨ÙƒØ©: 5 Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø·Ø± ===== */
        .offers-grid, .products-grid { 
            display: grid; 
            /* 5 Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            grid-template-columns: repeat(5, 1fr); 
            gap: 20px; 
            padding: 0 20px; 
            margin: 0 auto 40px auto; 
            max-width: 1400px; 
        }

        .section-title { text-align: center; margin: 40px auto 30px; font-size: 1.8rem; color: var(--primary); font-weight: 800; background: rgba(255, 255, 255, 0.9); padding: 8px 40px; border-radius: 50px; display: block; width: fit-content; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-content { background: white; width: 95%; max-width: 600px; padding: 30px; border-radius: 15px; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3); }
        .close-modal { position: absolute; left: 20px; top: 15px; font-size: 2rem; cursor: pointer; color: #999; }
        
        .admin-panel { display: none; margin: 20px auto; width: 95%; max-width: 1200px; background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 15px; box-shadow: var(--shadow); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; font-size: 0.9rem; }
        th { background: var(--primary); color: white; }
        .product-table input, .product-table select { padding: 5px; text-align: center; border: 1px solid #ccc; border-radius: 4px; width: 90%; }
        
        .status-badge { padding: 4px 8px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; color: white; display: inline-block; }
        .status-new { background: #3498db; } .status-sent { background: #f39c12; } .status-delivered { background: #27ae60; } .status-completed { background: #2c3e50; } .status-cancelled { background: #e74c3c; } .status-postponed { background: #9b59b6; }
        
        .checkbox-group { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }
        .checkbox-group label { background: #eee; padding: 5px 10px; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.9rem; }
        .checkbox-group input:checked+span { color: var(--primary); font-weight: bold; }
        
        .financial-summary { margin-top: 20px; background: #f1f8e9; padding: 15px; border-radius: 10px; border: 1px solid var(--primary); display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px; }
        .fin-item { text-align: center; }
        .fin-val { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        
        footer { margin-top: auto; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(10px); color: #ddd; padding: 50px 20px; text-align: center; border-top: 5px solid var(--secondary); }
        .footer-content { max-width: 800px; margin: 0 auto; }
        .footer-title { font-size: 2rem; font-weight: 800; margin-bottom: 20px; color: var(--secondary); }
        .footer-info { font-size: 1.1rem; line-height: 1.8; margin-bottom: 10px; }
        .footer-info i { color: var(--primary); margin-left: 10px; }
        .footer-copyright { margin-top: 30px; border-top: 1px solid #444; padding-top: 20px; font-size: 0.9rem; opacity: 0.7; }
        
        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        @media (max-width: 1200px) {
            .offers-grid, .products-grid { grid-template-columns: repeat(4, 1fr); }
        }
        @media (max-width: 992px) {
            .offers-grid, .products-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 768px) {
            header { padding: 10px 15px; height: auto; min-height: 70px; flex-wrap: wrap; }
            .offers-grid, .products-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 10px; }
            .hero-slider { height: 220px; }
            .card-actions { flex-direction: column; gap: 5px; }
            .table-responsive { display: block; width: 100%; overflow-x: auto; white-space: nowrap; }
            .modal-content { padding: 20px; width: 95%; margin: 10px; }
        }
    </style>
</head>

<body>

    <header>
        <a href="?page=main" class="logo-container">
            <img src="https://cdn-icons-png.flaticon.com/512/628/628283.png" id="headerLogo" alt="Ø´Ø¹Ø§Ø± Ø¬Ø±ÙŠÙ† Ø¬ÙˆÙ„Ø¯Ù†" class="logo-img" width="60" height="60">
            <div class="logo-text-box">
                <h1 class="logo-text" id="storeName">GREEN GOLDEN</h1>
                <p class="logo-sub">Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© Ø§Ù„Ù…Ù…ÙŠØ²Ø© (Ø¨Ø°ÙˆØ±ØŒ Ø£Ø³Ù…Ø¯Ø©ØŒ Ù…Ø¹Ø¯Ø§Øª)</p>
            </div>
        </a>
        <div>
            <button class="nav-btn" onclick="openModal('cartModal')" aria-label="Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª"><i class="fas fa-shopping-basket"></i><span class="badge" id="cartCount">0</span></button>
            <button class="nav-btn" onclick="openModal('adminLoginModal')" aria-label="Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"><i class="fas fa-user-shield"></i></button>
        </div>
    </header>

    <div class="hero-slider" id="mainSlider">
        <div class="slide active" style="background-image: url('https://mashhourseeds.com/wp-content/uploads/2023/11/%D8%B7%D9%84%D8%A7%D8%A1-%D8%A8%D8%B0%D9%88%D8%B1-%D8%A7%D9%84%D8%AA%D9%82%D8%A7%D9%88%D9%8A-1140x570-1.jpg');"><div class="slide-content"><h2>Ø£ÙØ¶Ù„ Ø§Ù„Ø¨Ø°ÙˆØ± Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©</h2><p>Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø¹Ø§Ù„ÙŠØ© ÙˆÙ…Ø­Ø§ØµÙŠÙ„ ÙˆÙÙŠØ±Ø©</p></div></div>
        <div class="slide" style="background-image: url('https://modo3.com/thumbs/fit630x300/271937/1690982594/%D8%A3%D9%86%D9%88%D8%A7%D8%B9_%D8%A7%D9%84%D8%A3%D8%B3%D9%85%D8%AF%D8%A9_%D9%88%D9%81%D9%88%D8%A7%D8%A6%D8%AF%D9%87%D8%A7.jpg');"><div class="slide-content"><h2>Ø£Ø³Ù…Ø¯Ø© ÙˆÙ…ØºØ°ÙŠØ§Øª</h2><p>Ø­Ù„ÙˆÙ„ Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„ØªØ±Ø¨Ø© Ø®ØµØ¨Ø©</p></div></div>
        <div class="slide" style="background-image: url('https://i.ytimg.com/vi/9lwOFgFdCYo/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLDaKlXGSiQfI6DAkPL4uST-JwVxDw');"><div class="slide-content"><h2>Ù…Ø¹Ø¯Ø§Øª Ø­Ø¯ÙŠØ«Ø©</h2><p>ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</p></div></div>
        <div class="slide" style="background-image: url('https://images.pexels.com/photos/4503269/pexels-photo-4503269.jpeg');"><div class="slide-content"><h2>Ø£ØµØµ ÙˆØ´ÙˆØ§Ù„ÙŠ</h2><p>Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø­Ø¯Ø§Ø¦Ù‚ Ù…Ù…ÙŠØ²Ø©</p></div></div>
        <div class="slide" style="background-image: url('https://images.pexels.com/photos/2255935/pexels-photo-2255935.jpeg');"><div class="slide-content"><h2>Ù…Ø­Ø§ØµÙŠÙ„ Ø·Ø¨ÙŠØ¹ÙŠØ©</h2><p>Ø¬ÙˆØ¯Ø© ØªØ³ØªØ­Ù‚ Ø§Ù„Ø«Ù‚Ø©</p></div></div>
    </div>

    <div class="sticky-filter-container">
        <div class="filters" id="categoryFilters"></div>
        <div class="sub-filters" id="subCategoryFilters"></div>
    </div>

    <div id="loader" style="text-align:center; padding:20px; font-weight:bold; color:var(--primary);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>

    <!-- Admin Panel -->
    <div id="adminDashboard" class="admin-panel">
        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª -->
        <div style="text-align:center; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
            <h2 style="color:var(--primary); margin-bottom:10px;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <div style="display:flex; gap:5px; justify-content:center; flex-wrap:wrap;">
                <button class="btn" onclick="openModal('ordersLoginModal')" style="width:auto; background:#8e44ad; font-size:0.9rem;"><i class="fas fa-file-invoice-dollar"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
                <button class="btn" onclick="openModal('catManagerModal')" style="width:auto; background:#007bff; font-size:0.9rem;">Ø§Ù„ÙØ¦Ø§Øª</button>
                <button class="btn" onclick="exportToExcelDetailed()" style="width:auto; background:green; font-size:0.9rem;"><i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ±</button>
                
                <button class="btn" onclick="window.open('?page=main', '_blank')" style="width:auto; background:#2e7d32; font-size:0.9rem; border:1px solid white;">Green Golden</button>
                <button class="btn" onclick="window.open('?page=anas', '_blank')" style="width:auto; background:#d32f2f; font-size:0.9rem; border:1px solid white;">Anas Garden</button>
                <button class="btn" onclick="window.open('?page=asas', '_blank')" style="width:auto; background:#795548; font-size:0.9rem; border:1px solid white;">Ø£ØµØµ</button>
            </div>
        </div>

        <div style="margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 10px;">
            <h3><i class="fab fa-whatsapp"></i> Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</h3>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:10px; margin-top:10px;">
                <div><label>Green Golden</label><input type="text" id="phoneMain" placeholder="201xxxx"></div>
                <div><label>Anas Garden</label><input type="text" id="phoneAnas" placeholder="201xxxx"></div>
                <div><label>Ø£ØµØµ ÙˆØ´ÙˆØ§Ù„ÙŠ</label><input type="text" id="phoneAsas" placeholder="201xxxx"></div>
            </div>
            <button class="btn" onclick="saveSettings()" style="width:auto; margin-top:10px;">Ø­ÙØ¸ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</button>
        </div>

        <h3 id="formTitle">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬</h3>
        <form id="productForm" onsubmit="handleProductSubmit(event)">
            <input type="hidden" id="pId">
            <div class="form-grid">
                <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label><input type="text" id="pName" required></div>
                <div class="form-group"><label>Ø§Ù„Ø³Ø¹Ø± (Ø¬.Ù…)</label><input type="number" id="pPrice" required></div>
                <div class="form-group"><label>Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)</label><input type="number" id="pWeight" step="0.01" required></div>
                <div class="form-group"><label style="color:var(--danger)">Ø§Ù„Ø±Ø¨Ø­ (Ø¬.Ù…)</label><input type="number" id="pProfit" step="0.01" placeholder="Ø±Ø¨Ø­ Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©" required style="border-color:var(--danger)"></div>
            </div>
            <div class="form-group"><label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label><input type="text" id="pImg" placeholder="https://..." required></div>
            <div class="form-grid">
                <div class="form-group"><label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label><select id="pCat" required></select></div>
                <div class="form-group"><label>ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©</label><input type="text" id="pSubCat"></div>
            </div>
            <div class="form-grid">
                <div class="form-group"><label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶</label><select id="pOffer"><option value="false">Ø¹Ø§Ø¯ÙŠ</option><option value="true">Ø¹Ø±Ø¶ Ø®Ø§Øµ (Golden)</option></select></div>
                <div class="form-group"><label>Ø§Ù„ØªÙˆÙØ±</label><select id="pStatus"><option value="true">Ù…ØªØ§Ø­</option><option value="false">ØºÙŠØ± Ù…ØªØ§Ø­</option></select></div>
                <div class="form-group"><label>Ø§Ù„Ø¸Ù‡ÙˆØ±</label><select id="pVisible"><option value="true">Ù…Ø±Ø¦ÙŠ</option><option value="false">Ù…Ø®ÙÙŠ</option></select></div>
            </div>
            <div class="form-group"><label>Ø§Ù„ÙˆØµÙ</label><textarea id="pDesc" rows="2" required></textarea></div>
            <div style="display:flex; gap:10px">
                <button type="submit" class="btn" id="submitBtn">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
                <button type="button" class="btn btn-danger" id="cancelEditBtn" onclick="cancelEdit()" style="display:none;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>

        <hr style="margin:30px 0">
        <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
        <div style="overflow-x:auto;">
            <table class="product-table">
                <thead><tr><th>ØµÙˆØ±Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø±Ø¨Ø­</th><th>Ø§Ù„ÙˆØ²Ù†</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ØªØ­ÙƒÙ…</th></tr></thead>
                <tbody id="adminProductTableBody"></tbody>
            </table>
        </div>
    </div>

    <h2 class="section-title">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h2>
    <div class="offers-grid" id="offersContainer"></div>
    <h2 class="section-title" id="productsTitle">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <div class="products-grid" id="productsContainer"></div>

    <footer>
        <div class="footer-content">
            <div class="footer-title" id="footerTitle">GREEN GOLDEN</div>
            <div class="footer-info"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</div>
            <div class="footer-info"><i class="fas fa-phone"></i> Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆÙ…ØªØ§Ø¨Ø¹Ø©: 01150009852</div>
            <div class="footer-info"><i class="fas fa-user-tie"></i> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: 01150009852</div>
            <div class="footer-copyright">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2025</div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('cartModal')">&times;</span>
            <h2><i class="fas fa-shopping-basket"></i> Ø§Ù„Ø³Ù„Ø©</h2>
            <div id="cartItems"></div>
            <hr style="margin:15px 0">
            <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>
            <form id="checkoutForm" onsubmit="checkout(event)">
                <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="cName" required></div>
                <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="tel" id="cPhone" required></div>
                <div class="form-group"><label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label><select id="cGov" required onchange="calculateTotals()"><option value="">Ø§Ø®ØªØ±...</option></select></div>
                <div class="form-group"><label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù†</label><select id="cShipMethod" required onchange="calculateTotals()"><option value="home">ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„</option><option value="post">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯</option></select></div>
                <div class="form-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input type="text" id="cAddress" required></div>
                <div style="background:#f1f8e9; padding:15px; border-radius:10px; border:1px solid var(--primary); margin-bottom:15px;">
                    <div style="display:flex; justify-content:space-between;"><span>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span><span id="subTotalDisplay">0</span></div>
                    <div style="display:flex; justify-content:space-between;"><span>Ø§Ù„Ø´Ø­Ù†:</span><span id="shippingDisplay">0</span></div>
                    <hr>
                    <div style="display:flex; justify-content:space-between; font-weight:bold; color:var(--primary); font-size:1.2rem;"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="grandTotalDisplay">0</span></div>
                </div>
                <button type="submit" class="btn"><i class="fab fa-whatsapp"></i> Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
            </form>
        </div>
    </div>

    <!-- Admin Login -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content" style="text-align:center; max-width:400px;">
            <span class="close-modal" onclick="closeModal('adminLoginModal')">&times;</span>
            <h2 style="color:var(--primary); margin-bottom:20px;">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <input type="text" id="adminUser" placeholder="User" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
            <input type="password" id="adminPass" placeholder="Pass" style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ccc; border-radius:5px;">
            <button class="btn" onclick="loginAdmin()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <!-- Orders Management Login -->
    <div id="ordersLoginModal" class="modal">
        <div class="modal-content" style="text-align:center; max-width:400px;">
            <span class="close-modal" onclick="closeModal('ordersLoginModal')">&times;</span>
            <h2 style="color:var(--primary); margin-bottom:20px;">Ø¯Ø®ÙˆÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
            <p style="margin-bottom:10px; color:#666;">ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ù‡ÙˆÙŠØªÙƒ</p>
            <input type="text" id="ordUser" placeholder="User" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
            <input type="password" id="ordPass" placeholder="Pass" style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ccc; border-radius:5px;">
            <button class="btn" onclick="loginOrders()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <!-- Orders System Modal -->
    <div id="ordersSystemModal" class="modal">
        <div class="modal-content" style="width:98%; max-width:1400px; padding:20px;">
            <span class="close-modal" onclick="closeModal('ordersSystemModal')">&times;</span>
            <h2 style="color:var(--primary); text-align:center; margin-bottom:20px;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</h2>
            
            <!-- Ø¬Ø¯ÙˆÙ„ 1: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
            <div style="background:#fff; border:1px solid #ddd; padding:15px; border-radius:10px; margin-bottom:30px;">
                <h3 style="border-bottom:2px solid var(--secondary); padding-bottom:10px; margin-bottom:15px;">Ø¬Ø¯ÙˆÙ„ 1: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
                <div class="table-responsive" style="overflow-x:auto;">
                    <table class="product-table" style="font-size:0.9rem;">
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹</th>
                                <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ - Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†)</th>
                                <th>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†</th>
                                <th>Ø§Ù„Ø¨Ø§Ø¦Ø¹</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>#</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ 2: Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© -->
            <div style="background:#fff; border:1px solid #ddd; padding:15px; border-radius:10px;">
                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--secondary); padding-bottom:10px; margin-bottom:15px; flex-wrap:wrap;">
                    <h3>Ø¬Ø¯ÙˆÙ„ 2: Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
                    <button class="btn btn-warning" onclick="markFilteredAsCompleted()" style="width:auto; font-size:0.9rem;">ØªØ®Ù„ÙŠØµ Ø§Ù„Ù…Ø­Ø¯Ø¯ (ØªØ­ÙˆÙŠÙ„ Ù„Ù€ Ø®Ø§Ù„Øµ)</button>
                </div>
                
                <!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
                <div style="background:#f9f9f9; padding:10px; border-radius:8px; margin-bottom:15px;">
                    <strong>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶:</strong>
                    <div style="display:flex; gap:15px; flex-wrap:wrap; align-items:center; margin-top:10px;">
                        <div>
                            <label>Ø§Ù„Ø¨Ø§Ø¦Ø¹:</label>
                            <select id="filterSeller" onchange="renderFinancialTable()" style="padding:5px;">
                                <option value="all">Ø§Ù„ÙƒÙ„</option>
                                <option value="Green Golden">Green Golden</option>
                                <option value="Anas Garden">Anas Garden</option>
                                <option value="Ø£ØµØµ ÙˆØ´ÙˆØ§Ù„ÙŠ">Ø£ØµØµ ÙˆØ´ÙˆØ§Ù„ÙŠ</option>
                            </select>
                        </div>
                        <div style="flex:1;">
                            <div class="checkbox-group">
                                <label><input type="checkbox" value="Ø¬Ø¯ÙŠØ¯" checked onchange="renderFinancialTable()"> <span>Ø¬Ø¯ÙŠØ¯</span></label>
                                <label><input type="checkbox" value="ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„" checked onchange="renderFinancialTable()"> <span>ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„</span></label>
                                <label><input type="checkbox" value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" checked onchange="renderFinancialTable()"> <span>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</span></label>
                                <label><input type="checkbox" value="Ø®Ø§Ù„Øµ" checked onchange="renderFinancialTable()"> <span>Ø®Ø§Ù„Øµ</span></label>
                                <label><input type="checkbox" value="Ù…Ù„ØºÙŠ" onchange="renderFinancialTable()"> <span>Ù…Ù„ØºÙŠ</span></label>
                                <label><input type="checkbox" value="ØªØ£Ø¬ÙŠÙ„" onchange="renderFinancialTable()"> <span>ØªØ£Ø¬ÙŠÙ„</span></label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-responsive" style="overflow-x:auto;">
                    <table class="product-table" style="font-size:0.9rem;">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø±Ø¨Ø­</th>
                                <th>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>#</th>
                            </tr>
                        </thead>
                        <tbody id="financialTableBody"></tbody>
                    </table>
                </div>

                <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª -->
                <div class="financial-summary">
                    <div class="fin-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†<br><span class="fin-val" id="totalDepositVal">0</span></div>
                    <div class="fin-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­<br><span class="fin-val" id="totalProfitVal">0</span></div>
                    <div class="fin-item">Ø§Ù„ÙØ±Ù‚ (Ø§Ù„ØµØ§ÙÙŠ)<br><span class="fin-val" id="totalDiffVal" style="color:green;">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Manager -->
    <div id="catManagerModal" class="modal">
        <div class="modal-content" style="max-width:400px;">
            <span class="close-modal" onclick="closeModal('catManagerModal')">&times;</span>
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª</h2>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input type="text" id="newCatInput" placeholder="ÙØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø©" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:5px;">
                <button class="btn" onclick="addNewCategoryFromModal()" style="width:auto">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
            <div style="background:#f9f9f9; padding:15px; border-radius:10px;">
                <select id="editCatSelect" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;"></select>
                <input type="text" id="editCatNameInput" placeholder="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;">
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-warning" onclick="updateCategoryName()">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="btn btn-danger" onclick="deleteCategoryRef()">Ø­Ø°Ù</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCUBnTBIM7NOiIqKHK5LFUqqHAfHC-vzao",
            authDomain: "green-golden-dad1c.firebaseapp.com",
            databaseURL: "https://green-golden-dad1c-default-rtdb.firebaseio.com",
            projectId: "green-golden-dad1c",
            storageBucket: "green-golden-dad1c.firebasestorage.app",
            messagingSenderId: "305717091280",
            appId: "1:305717091280:web:d818ffb49e4789675077d5",
            measurementId: "G-TJNV6E7LQG"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø± (3 ØµÙØ­Ø§Øª ÙÙ‚Ø·)
        const storeConfigs = {
            'main': { name: 'GREEN GOLDEN', primaryColor: '#2e7d32', bg: 'https://images.pexels.com/photos/34948608/pexels-photo-34948608.jpeg' },
            'anas': { name: 'Anas Garden', primaryColor: '#d32f2f', bg: 'https://images.pexels.com/photos/34942441/pexels-photo-34942441.jpeg' },
            'asas': { name: 'Ø£ØµØµ ÙˆØ´ÙˆØ§Ù„ÙŠ', primaryColor: '#795548', bg: 'https://images.pexels.com/photos/34949303/pexels-photo-34949303.jpeg' }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const currentPageKey = urlParams.get('page') || 'main';
        const currentStore = storeConfigs[currentPageKey] || storeConfigs['main'];

        document.documentElement.style.setProperty('--primary', currentStore.primaryColor);
        document.title = currentStore.name;
        document.getElementById('storeName').innerText = currentStore.name;
        document.getElementById('footerTitle').innerText = currentStore.name;
        document.body.style.backgroundImage = `url('${currentStore.bg}')`;

        let products = [], categories = [], cart = [], orders = [];
        let settings = { phones: { main: "", anas: "", asas: "" }, lastInvoice: 1000 };
        let editingProductId = null;
        let currentFilter = { cat: 'all', sub: null };

        const shippingRatesHome = { "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©": 55, "Ø§Ù„Ø¨Ø­ÙŠØ±Ø©": 50, "Ø§Ù„Ø¬ÙŠØ²Ø©": 50, "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©": 50, "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©": 50, "Ø§Ù„ØºØ±Ø¨ÙŠØ©": 50, "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©": 50, "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©": 50, "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©": 50, "Ø§Ù„Ù…Ù†ÙŠØ§": 75, "Ø§Ù„ÙÙŠÙˆÙ…": 55, "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯": 60, "Ø¯Ù…ÙŠØ§Ø·": 60, "Ù‚Ù†Ø§": 100, "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®": 55, "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯": 100, "Ø£Ø³ÙˆØ§Ù†": 100, "Ø£Ø³ÙŠÙˆØ·": 85, "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ": 55, "Ù…Ø·Ø±ÙˆØ­": 85, "Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡": 85, "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©": 55, "Ø³ÙˆÙ‡Ø§Ø¬": 95, "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡": 75, "Ø§Ù„Ø£Ù‚ØµØ±": 100, "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±": 95, "Ø§Ù„Ø³ÙˆÙŠØ³": 55 };
        const governorates = Object.keys(shippingRatesHome).sort();

        document.addEventListener("DOMContentLoaded", () => {
            initSlider(); populateGovernorates();
            document.getElementById('loader').style.display = 'block';

            db.ref('categories').on('value', snap => {
                const val = snap.val();
                categories = val ? (Array.isArray(val) ? val : Object.values(val)) : ["Ø¹Ø§Ù…"];
                updateCategorySelects();
                updateDynamicFilters();
            });

            db.ref('products').on('value', snap => {
                products = snap.val() ? Object.values(snap.val()) : [];
                
                // ØªØ±ØªÙŠØ¨ Ø£Ø¨Ø¬Ø¯ÙŠ
                products.sort((a, b) => (a.name || "").localeCompare((b.name || ""), 'ar'));

                renderProducts(currentFilter.cat, currentFilter.sub);
                renderAdminProductsTable();
                document.getElementById('loader').style.display = 'none';
            });

            db.ref('orders').on('value', snap => { 
                orders = snap.val() ? Object.values(snap.val()) : [];
                
                const activeEl = document.activeElement;
                const isWriting = activeEl && (activeEl.tagName === 'INPUT' || activeEl.tagName === 'SELECT') && document.getElementById('ordersSystemModal').contains(activeEl);
                
                if (document.getElementById('ordersSystemModal').style.display === 'flex') {
                    if (!isWriting) renderOrdersTable();
                    renderFinancialTable();
                }
            });

            db.ref('settings').on('value', snap => {
                if (snap.val()) { 
                    settings = snap.val(); 
                    if(settings.phones) {
                        document.getElementById('phoneMain').value = settings.phones.main || '';
                        document.getElementById('phoneAnas').value = settings.phones.anas || '';
                        document.getElementById('phoneAsas').value = settings.phones.asas || '';
                    }
                }
            });
            
            // ØªÙØ¹ÙŠÙ„ Ø²Ø± Enter
            document.getElementById("adminPass").addEventListener("keypress", function(event) { if (event.key === "Enter") loginAdmin(); });
            document.getElementById("ordPass").addEventListener("keypress", function(event) { if (event.key === "Enter") loginOrders(); });
        });

        // Ø¯ÙˆØ§Ù„ Ø£Ø³Ø§Ø³ÙŠØ©
        function initSlider() { const s = document.querySelectorAll('.slide'); let i=0; setInterval(() => { s[i].classList.remove('active'); i=(i+1)%s.length; s[i].classList.add('active'); }, 4000); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; if(id==='ordersSystemModal'){renderOrdersTable(); renderFinancialTable();} }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        window.onclick = e => { if (e.target.classList.contains('modal')) e.target.style.display = 'none'; }
        function populateGovernorates() { const s = document.getElementById('cGov'); s.innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>'; governorates.forEach(g => { let o = document.createElement('option'); o.value = g; o.textContent = g; s.appendChild(o); }); }

        function updateCategorySelects() { const p = document.getElementById('pCat'), e = document.getElementById('editCatSelect'); p.innerHTML=''; e.innerHTML=''; categories.forEach(c => { let o = `<option value="${c}">${c}</option>`; p.innerHTML+=o; e.innerHTML+=o; }); }
        function updateDynamicFilters() {
            const b = document.getElementById('categoryFilters');
            let h = `<div class="filter-btn ${currentFilter.cat==='all'?'active':''}" onclick="setFilter('all', this)">Ø§Ù„ÙƒÙ„</div>`;
            categories.forEach(c => h += `<div class="filter-btn ${currentFilter.cat===c?'active':''}" onclick="setFilter('${c}', this)">${c}</div>`);
            b.innerHTML = h;
            const sb = document.getElementById('subCategoryFilters');
            if(currentFilter.cat === 'all') sb.style.display='none';
            else {
                const subs = [...new Set(products.filter(p=>p.cat===currentFilter.cat && p.sub).map(p=>p.sub))];
                if(subs.length) {
                    let sHtml = `<div class="sub-filter-btn ${currentFilter.sub===null?'active':''}" onclick="setSubFilter(null, this)">Ø§Ù„ÙƒÙ„</div>`;
                    subs.forEach(s => sHtml += `<div class="sub-filter-btn ${currentFilter.sub===s?'active':''}" onclick="setSubFilter('${s}', this)">${s}</div>`);
                    sb.innerHTML = sHtml; sb.style.display='flex';
                } else sb.style.display='none';
            }
        }
        function setFilter(c, el) { currentFilter.cat=c; currentFilter.sub=null; updateDynamicFilters(); renderProducts(c, null); }
        function setSubFilter(s, el) { currentFilter.sub=s; document.querySelectorAll('.sub-filter-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); renderProducts(currentFilter.cat, s); }

        function renderProducts(cat, sub) {
            const oc = document.getElementById('offersContainer'), pc = document.getElementById('productsContainer'); oc.innerHTML=''; pc.innerHTML='';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹
            const sortedProducts = [...products].sort((a, b) => (a.name || "").localeCompare((b.name || ""), 'ar'));

            sortedProducts.forEach(p => {
                if(p.isVisible === false) return;
                if(cat !== 'all' && p.cat !== cat) return;
                if(sub && p.sub !== sub) return;
                const h = `
                <div class="card">
                    ${p.offer ? '<span style="position:absolute; top:10px; right:10px; background:var(--danger); color:white; padding:3px 10px; border-radius:15px; font-size:0.8rem; z-index:5; font-weight:bold">Ø¹Ø±Ø¶ Ø®Ø§Øµ</span>' : ''}
                    <div class="img-wrapper" onclick="this.classList.toggle('active')"><img src="${p.img}" class="card-img" onerror="this.src='https://via.placeholder.com/200'"><div class="desc-overlay"><h4>${p.name}</h4><p>${p.desc}</p></div></div>
                    <div class="card-body"><div class="card-cat">${p.cat} ${p.sub?'> '+p.sub:''}</div><div class="card-title">${p.name}</div><div class="card-price">${p.price} Ø¬.Ù…</div>
                    <div class="card-actions">${p.isAvailable ? `<input type="number" id="qty-${p.id}" class="qty-input" value="1" min="1"><button class="btn" onclick="addToCart(${p.id})">Ø£Ø¶Ù</button>` : `<button class="btn" style="background:#ccc;" disabled>Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©</button>`}</div></div>
                </div>`;
                if(p.offer) oc.innerHTML += h; else pc.innerHTML += h;
            });
        }

        // Ø§Ù„Ø³Ù„Ø©
        function addToCart(id) { const p = products.find(x => x.id == id); const q = parseInt(document.getElementById(`qty-${id}`).value)||1; const ex = cart.find(x => x.id == id); if(ex) ex.qty+=q; else cart.push({...p, qty:q}); updateCartUI(); }
        function updateCartUI() {
            document.getElementById('cartCount').textContent = cart.reduce((a,c)=>a+c.qty, 0);
            const b = document.getElementById('cartItems'); b.innerHTML = '';
            cart.forEach((i, x) => b.innerHTML += `<div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:5px;"><img src="${i.img}" width="40">${i.name} (${i.qty})<button class="btn-danger" onclick="cart.splice(${x},1);updateCartUI()" style="width:auto; padding:2px 8px;">x</button></div>`);
            calculateTotals();
        }
        function calculateTotals() {
            let p=0, w=0; cart.forEach(i => { p+=i.price*i.qty; w+=(i.weight||0)*i.qty; });
            const g = document.getElementById('cGov').value, m = document.getElementById('cShipMethod').value;
            let s = 0; if(g) { if(m==='post') s = w<3?40 : w<5?50 : w<7?65 : w<10?80 : w<20?95 : 120; else s = (shippingRatesHome[g]||0) + (w>2 ? Math.ceil(w-2)*6 : 0); }
            document.getElementById('subTotalDisplay').textContent = p + ' Ø¬.Ù…';
            document.getElementById('shippingDisplay').textContent = s + ' Ø¬.Ù…';
            document.getElementById('grandTotalDisplay').textContent = (p+s) + ' Ø¬.Ù…';
            return {p, s, t:p+s};
        }
        function checkout(e) {
            e.preventDefault(); if(!cart.length) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
            const {p, s, t} = calculateTotals();
            const invId = (settings.lastInvoice || 1000) + 1;
            let profit = 0; cart.forEach(i => profit += (i.profit||0)*i.qty);
            const o = { invId, date: new Date().toLocaleDateString('en-GB'), name: document.getElementById('cName').value, phone: document.getElementById('cPhone').value, gov: document.getElementById('cGov').value, method: document.getElementById('cShipMethod').value, address: document.getElementById('cAddress').value, pTotal: p, shipping: s, total: t, profit: profit, deposit: 0, status: 'Ø¬Ø¯ÙŠØ¯', items: cart, storeSource: currentStore.name };
            
            db.ref('settings/lastInvoice').set(invId);
            db.ref('orders/' + invId).set(o).then(() => {
                let m = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ #${invId} Ù…Ù† ${currentStore.name}*\nğŸ‘¤ ${o.name}\nğŸ“± ${o.phone}\nğŸ“ ${o.gov}\nğŸ  ${o.address}\n\nğŸ›’ *Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:*\n`;
                cart.forEach(i => m += `- ${i.name} (${i.qty})\n`);
                m += `\nğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${t} Ø¬.Ù…`;
                cart=[]; updateCartUI(); closeModal('cartModal');
                const ph = (settings.phones && settings.phones[currentPageKey]) ? settings.phones[currentPageKey] : "201150009852";
                window.open(`https://wa.me/${ph}?text=${encodeURIComponent(m)}`, '_blank');
            });
        }

        // ======================= Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø³Ù„ÙŠÙ…) =======================
        function loginAdmin() { if(document.getElementById('adminUser').value==='admin' && document.getElementById('adminPass').value==='gold123') { closeModal('adminLoginModal'); openModal('adminDashboard'); renderAdminProductsTable(); } else alert('Ø®Ø·Ø£'); }
        function loginOrders() { if(document.getElementById('ordUser').value==='admin' && document.getElementById('ordPass').value==='gold123') { closeModal('ordersLoginModal'); openModal('ordersSystemModal'); renderOrdersTable(); renderFinancialTable(); } else alert('Ø®Ø·Ø£'); }
        function saveSettings() { 
            db.ref('settings/phones').set({ 
                main: document.getElementById('phoneMain').value, 
                anas: document.getElementById('phoneAnas').value, 
                asas: document.getElementById('phoneAsas').value
            }); alert('ØªÙ…'); 
        }

        // Ø¬Ø¯ÙˆÙ„ 1: Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­)
        function renderOrdersTable() {
            const b = document.getElementById('ordersTableBody'); b.innerHTML='';
            [...orders].sort((a,b)=>b.invId-a.invId).forEach(o => {
                const rem = (o.total||0) - (o.deposit||0);
                const st = ['Ø¬Ø¯ÙŠØ¯','ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„','Ù…Ù„ØºÙŠ','ØªØ£Ø¬ÙŠÙ„','Ø­Ø°Ù','ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…','Ø®Ø§Ù„Øµ'];
                let opts = ''; st.forEach(s => opts+=`<option value="${s}" ${o.status===s?'selected':''}>${s}</option>`);
                
                b.innerHTML += `<tr>
                    <td><input type="text" value="${o.trackingNum||''}" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹" onchange="updateTracking('${o.invId}', this.value)" oninput="updateTrackingLocal('${o.invId}', this.value)" style="width:120px;"></td>
                    <td style="font-weight:bold; color:var(--primary)" id="rem-${o.invId}">${rem}</td>
                    <td><input type="number" value="${o.deposit||0}" onchange="updateDeposit('${o.invId}', this.value)" oninput="updateDepositLocal('${o.invId}', this.value)" style="width:80px;"></td>
                    <td>${o.storeSource||'-'}</td>
                    <td><select id="status-select-${o.invId}" onchange="updateStatus('${o.invId}', this.value)">${opts}</select></td>
                    <td>${o.phone}</td>
                    <td>${o.name}</td>
                    <td>${o.date}</td>
                    <td>${o.invId}</td>
                </tr>`;
            });
        }

        // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ (Immediate & Optimistic Updates)
        function updateStatus(id, val) { 
            db.ref('orders/'+id+'/status').set(val); 
            const row = orders.find(x=>x.invId==id); 
            if(row) { row.status=val; renderFinancialTable(); } 
        }

        function updateDepositLocal(id, val) {
            const row = orders.find(x=>x.invId==id);
            if(row) {
                row.deposit = Number(val);
                document.getElementById(`rem-${id}`).innerText = (row.total||0) - row.deposit;
                renderFinancialTable(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³ÙÙ„ÙŠ ÙÙˆØ±Ø§Ù‹ ÙˆØ£Ù†Øª ØªÙƒØªØ¨
            }
        }

        function updateDeposit(id, val) { 
            const newVal = Number(val);
            db.ref('orders/'+id+'/deposit').set(newVal);
            updateDepositLocal(id, val);
        }

        function updateTrackingLocal(id, val) {
            const row = orders.find(x=>x.invId==id);
            if(row) {
                row.trackingNum = val;
                if(String(val).trim() !== '') {
                    row.status = 'ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„';
                    const sel = document.getElementById(`status-select-${id}`);
                    if(sel) sel.value = 'ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„';
                }
                renderFinancialTable();
            }
        }

        function updateTracking(id, val) {
            let u = {}; u['orders/'+id+'/trackingNum'] = val;
            if(String(val).trim() !== '') {
                u['orders/'+id+'/status'] = 'ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„';
            }
            db.ref().update(u);
            updateTrackingLocal(id, val);
        }

        // Ø¬Ø¯ÙˆÙ„ 2: Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©
        function renderFinancialTable() {
            const seller = document.getElementById('filterSeller').value;
            const checkedBoxes = document.querySelectorAll('.checkbox-group input:checked');
            const statusFilters = Array.from(checkedBoxes).map(cb => cb.value);

            const b = document.getElementById('financialTableBody'); b.innerHTML='';
            let dep=0, prof=0;

            orders.forEach(o => {
                const sellerMatch = seller === 'all' || o.storeSource === seller;
                const statusMatch = statusFilters.includes(o.status || 'Ø¬Ø¯ÙŠØ¯');

                if (sellerMatch && statusMatch) {
                    dep += Number(o.deposit||0);
                    prof += Number(o.profit||0);
                    b.innerHTML += `<tr><td><span class="status-badge status-${getStatusClass(o.status)}">${o.status||'Ø¬Ø¯ÙŠØ¯'}</span></td><td>${o.profit||0}</td><td>${o.deposit||0}</td><td>${o.phone}</td><td>${o.name}</td><td>${o.date}</td><td>${o.invId}</td></tr>`;
                }
            });
            document.getElementById('totalDepositVal').innerText = dep;
            document.getElementById('totalProfitVal').innerText = prof;
            document.getElementById('totalDiffVal').innerText = prof - dep;
        }

        function getStatusClass(s) {
            if(s==='Ø¬Ø¯ÙŠØ¯') return 'new'; if(s==='ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„') return 'sent';
            if(s==='ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…') return 'delivered'; if(s==='Ø®Ø§Ù„Øµ') return 'completed'; return 'cancelled';
        }

        function markFilteredAsCompleted() {
            if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
            const seller = document.getElementById('filterSeller').value;
            const checkedBoxes = document.querySelectorAll('.checkbox-group input:checked');
            const statusFilters = Array.from(checkedBoxes).map(cb => cb.value);
            
            const updates = {};
            orders.forEach(o => {
                const sellerMatch = seller === 'all' || o.storeSource === seller;
                const statusMatch = statusFilters.includes(o.status || 'Ø¬Ø¯ÙŠØ¯');
                if (sellerMatch && statusMatch) {
                    updates['orders/' + o.invId + '/status'] = 'Ø®Ø§Ù„Øµ';
                    o.status = 'Ø®Ø§Ù„Øµ'; // ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„ÙŠ
                }
            });

            if(Object.keys(updates).length > 0) {
                db.ref().update(updates).then(() => {
                    alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
                    renderOrdersTable(); renderFinancialTable();
                });
            } else {
                alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù„ØªØ­Ø¯ÙŠØ«Ù‡Ø§");
            }
        }

        // === Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… ===
        function handleProductSubmit(e) {
            e.preventDefault();
            const data = { name: document.getElementById('pName').value, price: Number(document.getElementById('pPrice').value), weight: Number(document.getElementById('pWeight').value), profit: Number(document.getElementById('pProfit').value), img: document.getElementById('pImg').value, cat: document.getElementById('pCat').value, sub: document.getElementById('pSubCat').value, offer: document.getElementById('pOffer').value === 'true', isAvailable: document.getElementById('pStatus').value === 'true', isVisible: document.getElementById('pVisible').value === 'true', desc: document.getElementById('pDesc').value };
            if (editingProductId) { data.id = editingProductId; db.ref('products/' + editingProductId).set(data); } else { data.id = Date.now(); db.ref('products/' + data.id).set(data); }
            alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); cancelEdit();
        }
        function renderAdminProductsTable() { const b = document.getElementById('adminProductTableBody'); b.innerHTML=''; products.forEach(p => b.innerHTML += `<tr><td><img src="${p.img}" width="40"></td><td>${p.name}</td><td>${p.price}</td><td style="color:var(--danger); font-weight:bold">${p.profit || 0}</td><td><button class="btn-warning" onclick="startEdit(${p.id})">ØªØ¹Ø¯ÙŠÙ„</button> <button class="btn-danger" onclick="if(confirm('Ø­Ø°ÙØŸ')) db.ref('products/'+${p.id}).remove()">Ø­Ø°Ù</button></td></tr>`); }
        function startEdit(id) { const p = products.find(x => x.id == id); if (!p) return; document.getElementById('pId').value = p.id; document.getElementById('pName').value = p.name; document.getElementById('pPrice').value = p.price; document.getElementById('pWeight').value = p.weight || 0; document.getElementById('pProfit').value = p.profit || 0; document.getElementById('pImg').value = p.img; document.getElementById('pCat').value = p.cat; document.getElementById('pSubCat').value = p.sub || ''; document.getElementById('pOffer').value = p.offer.toString(); document.getElementById('pStatus').value = (p.isAvailable !== false).toString(); document.getElementById('pVisible').value = (p.isVisible !== false).toString(); document.getElementById('pDesc').value = p.desc; editingProductId = id; document.getElementById('submitBtn').innerText = 'ØªØ­Ø¯ÙŠØ«'; document.getElementById('cancelEditBtn').style.display = 'inline-block'; document.getElementById('productForm').scrollIntoView({ behavior: 'smooth' }); }
        function cancelEdit() { document.getElementById('productForm').reset(); editingProductId = null; document.getElementById('submitBtn').innerText = 'Ø­ÙØ¸'; document.getElementById('cancelEditBtn').style.display = 'none'; }

        function exportToExcelDetailed() {
            if (!orders.length) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª");
            const wb = XLSX.utils.book_new(); const exportData = [];
            orders.forEach(order => { if (order.items && Array.isArray(order.items)) { order.items.forEach(item => { exportData.push({ "Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©": order.invId, "Ø§Ù„ØªØ§Ø±ÙŠØ®": order.date, "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„": order.name, "Ø§Ù„Ù…Ù†ØªØ¬": item.name, "Ø§Ù„ÙƒÙ…ÙŠØ©": item.qty, "Ø§Ù„Ø³Ø¹Ø±": item.price, "Ø§Ù„Ø§Ø¬Ù…Ø§Ù„Ù‰": item.price * item.qty, "Ù…Ù„Ø§Ø­Ø¸Ø§Øª": "", "ØµÙØ­Ø© Ù…ÙŠÙ† ØŸ": order.storeSource || "Green Golden", "ØªÙ„ÙŠÙÙˆÙ†1": order.phone, "ØªÙ„ÙŠÙÙˆÙ†2": "", "Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹": order.trackingNum || "", "Ø§Ù„Ø­Ø§Ù„Ø©": order.status || "Ø¬Ø¯ÙŠØ¯", "ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„": "", "Ø§Ù„Ø´Ø­Ù†": order.shipping || 0, "Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†": order.deposit || 0, "Ø§Ù„Ø±Ø¨Ø­": (item.profit || 0) * item.qty, "Ù…Ø³ØªÙ‡Ø¯Ù": (order.method === 'post' ? 'Ø¨Ø±ÙŠØ¯' : 'Ù…Ù†Ø²Ù„') }); }); } });
            const ws = XLSX.utils.json_to_sheet(exportData); ws['!cols'] = [{ wch: 10 }, { wch: 12 }, { wch: 20 }, { wch: 20 }, { wch: 8 }, { wch: 10 }, { wch: 10 }, { wch: 15 }, { wch: 15 }, { wch: 15 }];
            XLSX.utils.book_append_sheet(wb, ws, "Sales_Detailed"); XLSX.writeFile(wb, "Sales_Full_Report.xlsx");
        }

        function addNewCategoryFromModal() { const v = document.getElementById('newCatInput').value.trim(); if (v && !categories.includes(v)) db.ref('categories').set([...categories, v]).then(() => { alert('ØªÙ…'); document.getElementById('newCatInput').value = ''; }); }
        function updateCategoryName() { const old = document.getElementById('editCatSelect').value, nw = document.getElementById('editCatNameInput').value.trim(); if (old && nw) { let cats = [...categories]; cats[cats.indexOf(old)] = nw; db.ref('categories').set(cats); products.forEach(p => { if (p.cat === old) db.ref('products/' + p.id + '/cat').set(nw) }); alert('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„'); } }
        function deleteCategoryRef() { const v = document.getElementById('editCatSelect').value; if (confirm('Ø­Ø°Ù Ø§Ù„ÙØ¦Ø© ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ')) { db.ref('categories').set(categories.filter(c => c !== v)); products.forEach(p => { if (p.cat === v) db.ref('products/' + p.id).remove() }); alert('ØªÙ… Ø§Ù„Ø­Ø°Ù'); } }
    </script>
</body>
</html>
